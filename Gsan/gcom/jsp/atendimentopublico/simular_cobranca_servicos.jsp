<%@ taglib uri="/WEB-INF/struts-logic.tld" prefix="logic"%><%@ taglib uri="/WEB-INF/struts-template.tld" prefix="template"%><%@ taglib uri="/WEB-INF/struts-bean.tld" prefix="bean"%><%@ taglib uri="/WEB-INF/struts-html.tld" prefix="html"%><%@ taglib uri="/WEB-INF/c.tld" prefix="c"%>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html:html><head><title>GCOM - Sistema de Gest&atilde;o Comercial</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><link rel="stylesheet" href="<bean:message key="caminho.css"/>EstilosCompesa.css" type="text/css"><script language="JavaScript" src="<bean:message key="caminho.js"/>validacao/regras_validator.js"></script><html:javascript staticJavascript="false"  formName="SimularCobrancaServicoActionForm"/><script language="JavaScript" src="<bean:message key="caminho.js"/>util.js"></script><script language="JavaScript" src="<bean:message key="caminho.js"/>Calendario.js" ></script><script language="JavaScript" src="<bean:message key="caminho.js"/>validacao/ManutencaoRegistro.js"></script><script language="JavaScript" src="<bean:message key="caminho.js"/>jquery/jquery.js" ></script>
<script language="JavaScript">
	 	$(document).ready(function(){		habilitaServico();		//Verifica radio selecionado		var valor=1;		$('input:radio[name=tipoConsulta]').each(function() {		if ($(this).is(':checked'))			valor = parseInt($(this).val());			mudaTela(valor);		});		//Se serviço for preenchido torna data obrigatório		var servico = $("[name=tipoServico]").val();		if ((servico != '') && (valor==2)){			document.getElementById('periodoObrigatorio').style.visibility = 'visible';		} else {			document.getElementById('periodoObrigatorio').style.visibility = 'hidden'; 		}	});		//Função que habilita o campo serviço após seleção da matricula	function habilitaServico(){		var matricula = $("[name=idImovel]").val();		var form = document.forms[0];		if (matricula == ''){			$("[name=tipoServico]").attr("disabled", "true");			//Desabilita Datas			if (form.tipoConsulta[1].checked){				form.dataInicial.disabled = true;	        	form.dataFinal.disabled = true;			}		} else {			$("[name=tipoServico]").attr("enable", "true");			//habilita Datas			if (form.tipoConsulta[1].checked){				form.dataInicial.disabled = false;	        	form.dataFinal.disabled = false;			}		}			}        	function recuperarDadosPopup(codigoRegistro, descricaoRegistro, tipoConsulta) {	    var form = document.forms[0];		    if (tipoConsulta == 'imovel') {	      form.action='exibirSimularCobrancaServicosAction.do?pesquisarImovel=sim&idImovel='+codigoRegistro;	      form.submit();	    } else if (tipoConsulta == 'tipoServico') {			form.tipoServico.value = codigoRegistro;		    form.nomeTipoServico.value = descricaoRegistro;		    form.nomeTipoServico.style.color = "#000000";	    }	}    	function mudaTela(numero){		//Altera div mostrada de acordo com a seleção do radio		if (numero==1){			document.getElementById('simulacaoImovel').style.visibility = 'visible'; 			document.getElementById('simulacaoImovel').style.position = 'relative';						document.getElementById('consultaRelatorio').style.visibility = 'hidden'; 			document.getElementById('consultaRelatorio').style.position = "absolute";						document.getElementById('periodo').style.visibility = 'hidden'; 			document.getElementById('periodo').style.position = "absolute";			document.getElementById('obrigatorio1').style.visibility = 'visible';			document.getElementById('obrigatorio2').style.visibility = 'visible';			document.getElementById('periodoObrigatorio').style.visibility = 'hidden';		} else { 			document.getElementById('consultaRelatorio').style.visibility = 'visible';			document.getElementById('consultaRelatorio').style.position = 'relative';			document.getElementById('periodo').style.visibility = 'visible';			document.getElementById('periodo').style.position = 'relative';						document.getElementById('simulacaoImovel').style.visibility = 'hidden';			document.getElementById('simulacaoImovel').style.position = "absolute";			document.getElementById('obrigatorio1').style.visibility = 'hidden';			document.getElementById('obrigatorio2').style.visibility = 'hidden';			document.getElementById('periodoObrigatorio').style.visibility = 'hidden';		} 		habilitaServico();	}
	function abrirPopupComValidacao(caminho, altura, largura,form) {		if(validarEmitirOrdemCorteForm(form)){			abrirPopupDeNome(caminho+document.forms[0].tipoHidden.value, altura, largura, 'Pesquisar', 'yes');		}	}	function limpar(){		//Limpar dados do form			var form = document.forms[0];		form.idImovel.value = "";			form.inscricaoImovel.value = "";		form.tipoServico.value = "";		form.nomeTipoServico.value = "";		form.tipoMedicao[0].checked = true;		form.valorCalculado.value="";		form.dataInicial.value="";		form.dataFinal.value="";		 habilitaServico();		 document.getElementById('periodoObrigatorio').style.visibility = 'hidden';	}		function limparPesquisaImovel() {	    var form = document.forms[0];	      form.idImovel.value = "";			  form.inscricaoImovel.value = "";		  habilitaServico();	}	function limparTipoServico() {		var form = document.forms[0];		form.tipoServico.value = "";		form.nomeTipoServico.value = "";		document.getElementById('periodoObrigatorio').style.visibility = 'hidden';	}		function validarFormCalcular() {		//validar dados		var form = document.forms[0];		var erro;		if (form.idImovel.value == "") {			erro = "Selecione um imóvel.";			alert(erro);			return false;		} else if (form.tipoServico.value == ""){			erro = "Selecione um tipo de serviço.";			alert(erro);			return false;		} else {			var tipo;			if (form.tipoMedicao[1].checked){ //agua				tipo = 1;			} else {				tipo = 2; // poço			}		    form.action='exibirSimularCobrancaServicosAction.do?calcular=sim&tipomedicao='+tipo;		    form.submit();		}	}		function validarFormRelatorio() {		var form = document.forms[0];		if (validarDatas(form)){			if (form.idImovel.value == "") {				form.action='gerarRelatorioTiposServicoAction.do';			    form.submit();				} else {				if (form.tipoServico.value==""){		    		form.action='gerarRelatorioDebitosCobrancaImovelAction.do';		    		form.submit();				} else if ((form.dataInicial.value == "" ) || (form.dataFinal.value == "")) {					alert("Favor informar datas inicial e final válidas.");						return false;									} else {					form.action='gerarRelatorioDebitosCobrancaImovelAction.do';		    		form.submit();				}			}		} else {			alert("Favor informar datas inicial e final válidas.");			return false;		}	}	function validarDatas(form){		if ((form.dataInicial.value == "" )^(form.dataFinal.value == "")) {			return false;		} else {			if (verificaAnoMesSemAlert(form.dataInicial)){				if (verificaAnoMesSemAlert(form.dataFinal)){					return true;				}			}			return false;					}	}	//Valida um campo do tipo Ano mês           	function verificaAnoMesSemAlert(mydata) {		var form = document.forms[0];		var situacao = true;		if (mydata.value.length == 7) {			dia = 1;	    	mes = mydata.value.substring(0,2); 	    	ano = mydata.value.substring(3,7); 	    	if ((!isNaN(mes) || !isNaN(ano)) && (mes.indexOf('.') == -1 && mes.indexOf(',') == -1 && mes.indexOf('/') == -1) &&				(ano.indexOf('.') == -1 && ano.indexOf(',') == -1 && ano.indexOf('/') == -1)) {	    		// verifica se o mes e valido 		    	if ((mes * 1) >= 1 && (mes * 1) <= 12 ) { 		        	// verifica se o ano e valido		        	if ((ano * 1) != 0 && (ano * 1) >= 1980) {		        		// verifica se e ano bissexto 		    			if ((mes * 1) == 2 && ((dia * 1) < 1 || (dia * 1) > 29 		    				|| ((dia * 1) > 28 && (((ano * 1) / 4) != (ano * 1) / 4)))) { 		       				situacao = false; 		    			}		        	} else {		        		situacao = false;		        	}		    	} else {		    		situacao = false;		    	} 			} else {				situacao = false;			}	    } else if (mydata.value.length > 0){	    	situacao = false;	    }	    if (!situacao) { 		   mydata.focus(); 		}		return situacao;	}</script></head>
<body leftmargin="5" topmargin="5" onload="javascript:setarFoco('${requestScope.mesAnoFaturamento}');">
<html:form action="/exibirSimularCobrancaServicosAction.do"
	name="SimularCobrancaServicoActionForm"
	type="gcom.gui.atendimentopublico.SimularCobrancaServicoActionForm"
	method="post"><%@ include file="/jsp/util/cabecalho.jsp"%>
<%@ include file="/jsp/util/menu.jsp" %>
<table width="770" border="0" cellspacing="5" cellpadding="0">
	  <tr>
	    <td width="130" valign="top" class="leftcoltext">
	      <div align="center">
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	
			<%@ include file="/jsp/util/informacoes_usuario.jsp"%>
	
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	
			<%@ include file="/jsp/util/mensagens.jsp"%>
	
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	        <p align="left">&nbsp;</p>
	      	</div>
	      	</td>
			<td width="600" valign="top" class="centercoltext">
		        <table height="100%">
			        <tr>
			          <td></td>
			        </tr>
		      	</table>

			<table width="100%" border="0" align="center" cellpadding="0"
				cellspacing="0">
				<tr>
					<td width="11"><img border="0"
						src="<bean:message key="caminho.imagens"/>parahead_left.gif" /></td>
					<td class="parabg">Simula&ccedil;&atilde;o de Valores de Servi&ccedil;os de Cobran&ccedil;a </td>
					<td width="11"><img border="0"
						src="<bean:message key="caminho.imagens"/>parahead_right.gif" /></td>
				</tr>
			</table>
			<p>&nbsp;</p>			
			<table width="100%" border="0">
				<tr>
					<td colspan="2"><strong>Tipo de Consulta</strong></td>
				</tr>
				<tr>					<td><html:radio property="tipoConsulta" onclick="javascript:limpar(); mudaTela(1);" value="1">Simula&ccedil;&atilde;o por Im&oacute;vel  </html:radio></td>					<td><html:radio property="tipoConsulta" onclick="javascript:limpar(); mudaTela(2);" value="2">Consulta/Relat&oacute;rios</html:radio></td>				</tr>				<tr><td colspan="2"><hr></td></tr>								<tr>			</table>						<div id="periodo" style="visibility:hidden; position:absolute">			<table border="0" width="100%">			<tr>         	<td><strong>Período de Referência:         	<font color="#FF0000"><label id="periodoObrigatorio">*</label></font></strong></td>        	<td>        		<html:text property="dataInicial" size="7" maxlength="7" onkeypress="javascript:mascaraAnoMes(this, event);somente_numero(this);"/>&nbsp;	            <strong> a </strong>	            <html:text property="dataFinal" size="7" maxlength="7" onkeypress="javascript:mascaraAnoMes(this, event);somente_numero(this);"/>&nbsp;mm/aaaa         	</td>                	</tr>        	</table>			</div>						<table border="0" width="100%">				<tr>				<td width="20%">				<strong>Matrícula:<font color="#FF0000"><label id="obrigatorio1">*</label></font></strong>				</td>				<td width="80%" colspan="2">					<html:text maxlength="9" property="idImovel"							size="10"							onkeypress="javascript:validaEnterComMensagem(event, 'exibirSimularCobrancaServicosAction.do', 'idImovel', 'Matrícula');return isCampoNumerico(event);" />												<a href="javascript:abrirPopup('exibirPesquisarImovelAction.do', 400, 800);">						<img width="23" height="21" border="0"							src="<bean:message key="caminho.imagens"/>pesquisa.gif" 							title="Pesquisar Imóvel" /></a> 					<logic:present name="inscricaoImovelEncontrada" scope="session">						<html:text property="inscricaoImovel" readonly="true"							style="background-color:#EFEFEF; border:0; color: #000000"							size="30" maxlength="30" />					</logic:present> 					<logic:notPresent name="inscricaoImovelEncontrada" scope="session">						<html:text property="inscricaoImovel" readonly="true"							style="background-color:#EFEFEF; border:0; color: #FF0000"							size="30" maxlength="30" />					</logic:notPresent> 						<a href="javascript:limparPesquisaImovel();">							<img src="<bean:message key="caminho.imagens"/>limparcampo.gif"							border="0" title="Limpar Imóvel" />						</a>				</td>							</tr>								<tr>					<td height="10"><strong> Tipo do Serviço: <span class="style2"> <strong>					<font color="#FF0000"><label id="obrigatorio2">*</label></font> </strong> </span> </strong></td>					<td colspan="3"><span class="style2"> <html:text property="tipoServico"						size="5" maxlength="3"						onkeypress="javascript:validaEnterComMensagem(event, 'exibirSimularCobrancaServicosAction.do', 'tipoServico','Tipo do Serviço');return isCampoNumerico(event);" />					<a href="javascript:abrirPopup('exibirPesquisarTipoServicoAction.do', 400, 800);" title="Pesquisar Serviço Tipo"> 					<img src="/gsan/imagens/pesquisa.gif" alt="Pesquisar" border="0"						height="21" width="23"></a> <logic:present						name="servicoTipoEncontrada" scope="session">						<html:text property="nomeTipoServico" readonly="true"							style="background-color:#EFEFEF; border:0; color: #000000"							size="38" />					</logic:present> <logic:notPresent name="servicoTipoEncontrada" scope="session">						<html:text property="nomeTipoServico" readonly="true"							style="background-color:#EFEFEF; border:0; color: #ff0000" size="38" />					</logic:notPresent> <a href="javascript:limparTipoServico();"> <img						border="0" title="Apagar"						src="<bean:message key='caminho.imagens'/>limparcampo.gif" /></a>					</span></td>				</tr>																<tr>
			</table>									<div id="simulacaoImovel">				<table border="0" width="100%">								<tr>					<td height="10"><strong>Tipo de Medi&ccedil;&atilde;o</strong></td>					<td>					<html:radio property="tipoMedicao" value="3">Nenhum  </html:radio>					<html:radio property="tipoMedicao" value="1">&Aacute;gua  </html:radio>					<html:radio property="tipoMedicao" value="2">Po&ccedil;o</html:radio>										</td>				</tr>								<tr>				<td width="20%">				<strong>Valor Calculado: </strong>				</td>					<td width="80%" colspan="2">						<html:text property="valorCalculado" readonly="true"  maxlength="8" style="background-color:#EFEFEF; border:0; color: #000000;"/>					</td>							</tr>								<tr>					<td height="10" colspan="3"><hr></td>				</tr>								<tr>					<td align="left" colspan="2">						<strong><font color="#FF0000">*</font></strong>Campos obrigat&oacute;rios					</td>				</tr>				<tr>					<td height="24"><input type="button" class="bottonRightCol"						value="Limpar" 						onclick="javascript:limpar();" />											</td>  					<td align="right"><input type="button" name="Button"						class="bottonRightCol" value="Calcular"						onclick="javascript:validarFormCalcular();"> 						</td>				</tr> 				</table>														</div>						<div id="consultaRelatorio" style="visibility:hidden; position:absolute">				<table border="0" width="100%">				<tr> <td height="10" colspan="3"><hr></td> </tr>				<tr> <td align="left" colspan="2">						<strong><font color="#FF0000">*</font></strong>Campos obrigat&oacute;rios					</td>				</tr>				<tr>					<td height="24"><input type="button" class="bottonRightCol"						value="Limpar" 						onclick="javascript:limpar();" />											</td>					<td align="right"><input type="button" name="Button"						class="bottonRightCol" value="Gerar Relatório"						onClick="javascript:validarFormRelatorio();"													/></td>				</tr>  				</table>			</div>
			<p>&nbsp;</p>
			</td>
		</tr>
	</table>
<%@ include file="/jsp/util/rodape.jsp"%>	
</html:form>
</body>
</html:html>
